import * as db from './database';

// --- HARDCODED VECTORS ---
const vector1 = [0.0929889976978302, -0.05619899928569794, -0.06595200300216675, -0.04867599904537201, -0.16041000187397003, -0.005236799828708172, 0.11277999728918076, 0.10671000182628632, -0.06875500082969666, 0.023442000150680542, -0.02173599973320961, -0.060036998242139816, -0.01179799996316433, -0.07279100269079208, 0.01091300044208765, -0.18181000649929047, -0.09470299631357193, -0.016439000144600868, -0.03646399825811386, 0.02356399968266487, 0.2069000005722046, 0.12060000002384186, -0.040973000228405, 0.07696100324392319, -0.08959999680519104, 0.01674499921500683, 0.08979000151157379, 0.003975700121372938, 0.09411100298166275, 0.027993999421596527, -0.1376899927854538, -0.11794000118970871, -0.018133999779820442, 0.0788709968328476, 
-0.17858999967575073, 0.058455001562833786, -0.056770000606775284, -0.10245999693870544, 0.07541800290346146, 0.10281000286340714, 0.062428999692201614, 0.02550699934363365, -0.0700799971818924, -0.005644899792969227, -0.11449000239372253, 0.06482800096273422, 0.0017194000538438559, 0.04937300086021423, 0.007627999875694513, -0.06212000176310539, 0.02210799977183342, -0.026141999289393425, -0.03346100077033043, 0.0020105999428778887, 0.05609399825334549, 0.028536999598145485, 0.07399000227451324, 0.03920000046491623, 0.20316000282764435, 0.2381799966096878, -0.10225000232458115, 0.04759399965405464, 0.00017383000522386283, 0.07431700080633163, -0.05930199846625328, 0.0119439996778965, -0.1905899941921234, 0.026311999186873436, 0.06342300027608871, -0.06667300313711166, -0.00025472999550402164, 0.14439000189304352, -0.08701600134372711, 0.07076600193977356, 0.22951999306678772, -0.16843000054359436, 0.01776999980211258, -0.012004000134766102, 0.010997000150382519, -0.012408999726176262, 0.0682540014386177, -0.11093000322580338, 0.10298000276088715, 0.15285000205039978, -0.09051000326871872, -0.08967000246047974, 0.07972399890422821, 0.1371999979019165, -0.0033903999719768763, -0.05476599931716919, -0.03824099898338318, 0.029689999297261238, 0.11727000027894974, -0.023621000349521637, 0.07260700315237045, 0.022165000438690186, -0.12555000185966492, 0.029309000819921494, 0.04206499829888344, -0.03395500034093857, -0.0754299983382225, -0.027574000880122185, -0.07590699940919876, 0.1700499951839447, -0.016096999868750572, 0.119889996945858, -0.012786000035703182, -0.0834209993481636, -0.06253500282764435, 0.04943599924445152, 0.0026219000574201345, -0.09086199849843979, 0.09197500348091125, 0.13155999779701233, -0.12525999546051025, 0.06881699711084366, -0.03457200154662132, -0.13431000709533691, -0.04940500110387802, 0.02800000086426735, -0.03919899836182594, -0.10103999823331833, 0.13077999651432037, 0.02446799911558628, 0.1115799993276596, -0.15505999326705933, -0.018662000074982643, 0.006916299927979708];

const vector2 = [-0.030799999833106995, -0.049400001764297485, 0.024399999529123306, -0.0828000009059906, 0.029200000688433647, 0.02850000001490116, -0.02070000022649765, -0.05570000037550926, -0.05829999968409538, 0.015200000256299973, 0.06830000132322311, 0.03480000048875809, -0.02410000003874302, 0.15080000460147858, 0.1348000019788742, -0.05820000171661377, -0.06830000132322311, 0.008200000040233135, -0.0617000013589859, -0.04580000042915344, 0.21950000524520874, -0.18960000574588776, -0.10350000113248825, 0.17599999904632568, 0.0851999968290329, -0.21389999985694885, -0.00279999990016222, 0.022199999541044235, -0.18539999425411224, 0.0843999981880188, 0.04129999876022339, -0.023499999195337296, 0.05490000173449516, -0.023499999195337296, -0.03840000182390213, 0.03020000085234642, -0.07000000029802322, -0.002300000051036477, 0.09939999878406525, 0.02329999953508377, -0.013000000268220901, -0.00279999990016222, -0.03700000047683716, -0.13410000503063202, 0.14900000393390656, 0.04360000044107437, -0.03849999979138374, -0.07509999722242355, 0.04340000078082085, -0.019700000062584877, -0.028699999675154686, 0.15309999883174896, -0.0868000015616417, 0.14990000426769257, 0.03400000184774399, -0.008799999952316284, 0.19050000607967377, -0.004900000058114529, 0.17409999668598175, 0.045099999755620956, -0.046799998730421066, 0.02759999968111515, -0.06069999933242798, 0.0803999975323677, -0.01140000019222498, -0.08569999784231186, -0.11230000108480453, -0.0020000000949949026, 0.05939999967813492, 0.01140000019222498, -0.0714000016450882, 0.06639999896287918, -0.01730000041425228, 0.05350000038743019, 0.15360000729560852, 0.018300000578165054, 0.03280000016093254, 0.10100000351667404, -0.08839999884366989, 0.01209999993443489, 0.04960000142455101, -0.15080000460147858, 0.019099999219179153, 0.027499999850988388, -0.1551000028848648, -0.025100000202655792, -0.024900000542402267, 0.09960000216960907, 0.0820000022649765, -0.0706000030040741, 0.06279999762773514, 0.15410000085830688, 0.17239999771118164, 0.006599999964237213, 0.030700000002980232, 0.039400000125169754, -0.22439999878406525, 0.08760000020265579, 0.0471000000834465, -0.009100000374019146, -0.13009999692440033, -0.00039999998989515007, -0.009700000286102295, 0.16259999573230743, -0.09120000153779984, 0.07519999891519547, -0.1485999971628189, -0.1054999977350235, -0.05510000139474869, 0.02710000053048134, 0.12060000002384186, -0.03889999911189079, 0.03579999879002571, -0.003800000064074993, -0.07010000199079514, 0.1623000055551529, -0.0020000000949949026, -0.047600001096725464, 0.04360000044107437, -0.12540000677108765, 0.0364999994635582, -0.04479999840259552, -0.093299999833107, -0.10109999775886536, -0.021400000900030136, -0.1379999965429306, 0.0778999999165535, 0.020800000056624413];

// --- TEST FUNCTION ---


// ... (keep your vectors) ...

export const testVectorSearch = async () => {
    console.log("\nğŸ§ª --- STARTING INTEGRATION TEST ---");
    
    // 1. Initial Connection
    console.log("   ğŸ”Œ Connecting to Database...");
    await db.connectDB();

    // 2. Perform Login as Admin
    console.log("   ğŸ” Attempting Login as 'admin'...");
    const loginResult = await db.loginOperator('admin', 'admin888');

    if (!loginResult.success) {
        console.error("   âŒ Login Failed! Aborting Test.");
        return;
    }
    
    console.log(`   âœ… Login Success! (Role: ${loginResult.role})`);
    console.log("   ğŸš€ Proceeding to Vector Search...");

    // 3. Test 1: Search Parent Table with Vector 1
    console.log("\nğŸ” Test 1: Searching PARENT table using VECTOR 1...");
    try {
        const result1 = await db.findClosestChild(vector1);
        
        // FIX: Check if result1 exists (it is null if no match)
        if (result1) {
            console.log(`   âœ… MATCH FOUND: ${result1.hn}`);
            console.log(`      Distance: ${result1.distance}`);
        } else {
            console.log("   âŒ No match found in Parent table.");
        }
    } catch (e) { console.error("   âš ï¸ Error testing Vector 1", e); }


    // 4. Test 2: Search Child Table with Vector 2
    console.log("\nğŸ” Test 2: Searching CHILD table using VECTOR 2...");
    try {
        const result2 = await db.findClosestParent(vector2);
        
        // FIX: Check if result2 exists
        if (result2) {
            console.log(`   âœ… MATCH FOUND: ${result2.hn}`);
            console.log(`      Distance: ${result2.distance}`);
        } else {
            console.log("   âŒ No match found in Child table.");
        }
    } catch (e) { console.error("   âš ï¸ Error testing Vector 2", e); }

    // 5. Cleanup
    console.log("\n   ğŸ”’ Switching back to Gatekeeper...");
    await db.connectAs('gatekeeper');

    console.log("\nğŸ --- TEST COMPLETE ---\n");
};